---

# 📘 PBAP (PANZER BLOCKS Assist Parts) 管理者向けシステム要件定義書

---

# 0. ドキュメント情報

* **文書名**：PBAP 管理者向けシステム要件定義書
* **バージョン**：v1.0
* **作成日**：2025-12-02
* **対象システム**：管理者ツール (Streamlit)

---

# 1. 概要

## 1.1 目的
PB管理者が **申請状況を一元管理し、効率的に発送対応できる仕組み** を提供する。

## 1.2 利用者
* **PB管理者**：申請内容を確認して部品発送を行う社内スタッフ

## 1.3 対象範囲
* PB管理者向けタスク管理画面
* PB管理者による発送処理（画像添付・コメント記入）
* **商品組立パーツ登録機能（画像自動抽出・登録）**

---

# 2. 業務フロー（管理者側）

1. 管理者ログイン
2. タスク一覧表示
3. 任意のタスクを開いて詳細を確認
4. 部品を準備
5. 発送した部品の写真アップロード＋メッセージ入力
6. 「処置完了」押下
7. 完了メール送信（ユーザー・管理者）

---

# 3. 機能要件

## 3.1 ログイン（認証）

**要件**
* HTTPS必須
* サブディレクトリ/サブドメインでユーザーとは別URL
* ID+PASS で認証
* セッション管理 or トークン管理

## 3.2 タスク一覧表示

**表示項目例**
* タスクID
* 申請日
* 商品名
* ユーザー名
* ステータス（未処理 / 処理中 / 完了）

**受入基準**
1. 最大10万件を想定し、性能劣化のないリスト表示
2. 検索・フィルタ（商品名や申請日など）

## 3.3 タスク詳細表示

**表示内容**
* 送付先情報
* 購入情報
* 不足部品情報
* 部品画像
* 部品ごとの必要数
* ユーザーへのメッセージ
* コメント

## 3.4 発送処理（管理者操作）

**要件**
* 管理者は発送する部品を撮影し、画像をアップロードできる
* ユーザーへのメッセージを入力できる
* コメントを入力できる

**受入基準**
1. 画像アップロードが可能（1タスクあたり、10枚以内）
2. ユーザーへのメッセージが保存される
3. コメントテキストが保存される

## 3.5 完了処理

**動作**
* 管理者が「処置完了」ボタンを押すとステータスを完了に変更
* 完了メールをユーザーおよび管理者に送信

## 3.6 商品組立パーツ登録機能（画像自動抽出）

**目的**
商品マスタ、組立画像、組立番号画像、部品画像を効率的に登録する。

**機能要件**
1.  **商品情報登録**: 商品名、シリーズ名等を登録する。
2.  **組立画像登録**: 取説ページ画像（大画像）をアップロード・登録する。
3.  **組立番号画像抽出・登録**:
    *   組立画像から「組立番号」に関連する領域を自動/半自動で抽出する。
    *   抽出結果を確認・修正し、組立番号画像（中画像）として登録する。
4.  **部品画像抽出・登録**:
    *   組立番号画像内の「部品枠」を自動識別し、部品画像（小画像）を抽出する。
    *   抽出結果を確認・修正し、部品画像として登録する。

**技術的要件**
*   画像処理には Python (OpenCV) を使用する。
*   抽出精度向上のため、手動補正機能（クロップ範囲の調整等）を有する。
*   **部品抽出ロジック**:
    *   最大フレーム選択
    *   高精細化（超解像+シャープ化）
    *   ノイズ除去（メディアンフィルタ）
    *   最小面積フィルタ

---

# 4. 非機能要件

## 4.1 セキュリティ
1. HTTPS 必須
2. 管理画面はID/PASSによる認証必須

## 4.2 性能要件
1. タスク 100,000 件想定
2. 通常利用で3秒以内の画面応答を目標

## 4.3 保守性
* 最大10名の同時利用を想定
* 設定値は環境変数で切り替え可能
* Docker コンテナ化して環境依存性を排除

## 4.4 ログ管理
* エラーログ
* 申請ログ
* 管理者操作ログ（最低限）

---

# 5. 通知要件

## 5.1 エラー通知（管理者向け）
* システム障害時にメール通知
* 重大エラー（申請データ保存失敗、画像アップロード失敗など）
