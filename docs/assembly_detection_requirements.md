# アセンブリ番号領域検出 - 要件定義書

## 1. 概要

組立図ページ画像から、複数のアセンブリ番号領域を自動検出し、ユーザーが確認・調整できる半自動システムを構築する。

## 2. 入力

### 2.1 組立図ページ画像
- **ファイル形式**: JPG/PNG/WebP
- **サイズ**: 可変（AssemblyDiagram.jpgサンプル: 約767KB）
- **内容**: 1ページに複数のアセンブリ番号領域が不規則に配置

## 3. 抽出対象: アセンブリ番号領域

### 3.1 必須要素
各アセンブリ番号領域には以下の3要素が含まれる：

1. **アセンブリ番号**（左上）
   - 数字のみ（1〜200程度、最大3桁）
   - 枝番なし（「31-A」などは存在しない）
   - 領域の左上に配置

2. **部品リスト**（枠で囲まれた領域）
   - 枠色: **赤**または**黒**（実線、太さ統一）
   - **青枠は除外**（組立詳細説明のため）
   - 各部品には「x1」「x2」形式の個数表示が必須

3. **組立図**
   - 部品を組み合わせた図

### 3.2 レイアウト制約
- アセンブリ番号領域は**重ならない**
- ページ余白に他の情報（タイトル、ページ番号など）が含まれる場合あり

## 4. 検出の優先順位

1. **左上の大きな数字**（アセンブリ番号）
2. **枠で囲まれた部品リスト**の存在
3. **部品が組み合わさった画像**

## 5. 操作フロー（半自動）

```
1. ユーザーが組立図ページをアップロード
   ↓
2. システムがアセンブリ番号領域を自動検出
   ↓
3. 検出結果を画像上に四角枠で表示
   ↓
4. ユーザーが枠を調整して領域を確定
   ↓
5. 次のアセンブリ番号領域へ（2に戻る）
   ↓
6. すべての領域を確定後、保存
```

## 6. サンプルデータ

### 入力画像
- `docs/AssemblyDiagram_sample/AssemblyDiagram.jpg`

### 期待される抽出結果
- `AssemblyDiagram_no31.jpg` - アセンブリ番号31の領域
- `AssemblyDiagram_no32.jpg` - アセンブリ番号32の領域
- `AssemblyDiagram_no33.jpg` - アセンブリ番号33の領域
- `AssemblyDiagram_no36.jpg` - アセンブリ番号36の領域

## 7. 技術的制約

### 7.1 色検出条件
- **検出対象**: 赤枠、黒枠
- **除外対象**: 青枠

### 7.2 パターン認識
- 「x1」「x2」などの個数表示の存在を確認
- アセンブリ番号（数字）のフォント・サイズは統一されている

## 8. 非機能要件

### 8.1 精度
- 完全自動ではなく、**ユーザーによる確認・調整を前提**
- 誤検出や検出漏れは許容する（UIで修正可能）

### 8.2 ユーザビリティ
- 検出結果をわかりやすく表示
- 枠の調整が直感的にできるUI

## 9. 実装アプローチ

### Phase 1: PoC（技術実証）
- 画像処理ロジックの開発と検証
- Jupyter NotebookまたはPythonスクリプトで実装
- サンプル画像で精度を検証

### Phase 2: Streamlit統合
- PoCで検証したロジックを`image_processing.py`に統合
- インタラクティブなUI（枠調整機能）を実装

### Phase 3: 改善
- ユーザーフィードバックに基づいた精度向上
- AI/機械学習の導入検討（YOLO、OCRなど）
