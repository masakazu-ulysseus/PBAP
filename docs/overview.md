# PBAP (PANZER BLOCKS Assist Parts) - プロジェクト概要

## 1. プロジェクトの目的

PBAP は、[パンツァーブロックス](https://panzer-blocks.com/) で購入したブロック戦車製品について、組み立て部品が不足していた場合に、ユーザーが不足部品を請求するためのシステムです。

### 現状の課題
現在は [お問い合わせページ](https://panzer-blocks.com/inquiries/) の手順に従い、ユーザーから手動で不足部品を請求してもらっている。

### 目標
この不足部品請求プロセスをシステム化し、ユーザー・管理者双方の効率を向上させる。

## 2. システム構成

### 2.1 ユーザー向けシステム
**目的**: ユーザーが不足部品を請求するためのWebアプリケーション

**主な機能**:
- 送付先情報の入力
- 購入情報の入力（シリーズ名、商品名、購入店、購入日、部品保証コード）
- 組立説明書の画像から不足部品を選択
- 申請送信・メール通知

**技術スタック**: Next.js (App Router), TypeScript, Tailwind CSS

### 2.2 PBAP管理者向けシステム
**目的**: 管理者が不足部品請求を処理し、商品データを管理するための内部ツール

**主な機能**:
1. **タスク管理機能**
   - ユーザーからの不足部品請求（タスク）の一覧表示
   - タスク詳細の確認
   - 発送処理（画像添付、メッセージ入力、完了処理）

2. **商品・画像登録機能**
   - 製品情報の登録（シリーズ名、国、商品名）
   - 組立説明書ページ画像のアップロード
   - 組立番号領域の選択・登録
   - 部品画像の自動抽出・登録

**技術スタック**: Python, Streamlit, OpenCV, Supabase

## 3. データフロー

```
[ユーザー]
    ↓ 不足部品を申請
[ユーザー向けシステム (Next.js)]
    ↓ タスク登録
[Supabase (PostgreSQL + Storage)]
    ↓ タスク参照
[管理者向けシステム (Streamlit)]
    ↓ 発送処理・完了
[ユーザーへメール通知]
```

## 4. 共通バックエンド

- **プラットフォーム**: Supabase
- **データベース**: PostgreSQL
- **ストレージ**: Supabase Storage (WebP画像)
- **認証**:
  - ユーザー側: 認証不要（部品保証コードで購入確認）
  - 管理者側: ID/パスワード認証

## 5. 開発状況

| コンポーネント | 状況 |
|--------------|------|
| ユーザー向けシステム | 未着手 |
| 管理者向けシステム - タスク管理 | ✅ 実装済み（一覧表示、詳細表示、ステータス更新、メール送信） |
| 管理者向けシステム - 商品登録 | ✅ 実装済み |
| 管理者向けシステム - 組立ページ管理 | ✅ 実装済み（画像アップロード、組立番号登録、手動/自動切り出し） |
| 管理者向けシステム - 組立番号管理 | ✅ 実装済み（部品抽出、手動割当、画像編集） |
| データベーススキーマ | ✅ 定義済み |
| 画像処理ロジック | ✅ 実装済み（部品自動抽出、透明背景処理） |
| ログ機能 | ✅ 実装済み（Loguru使用） |

## 6. 技術仕様・運用方針

### 6.1 部品保証コード
- 検証ロジック: チェックデジットによる検証（仕様あり）
- コード体系: **製品共通**（商品ごとに異なるコードではない）

### 6.2 開発優先度
1. **管理者向けシステム - 商品・画像登録機能** ← 現在開発中
2. 管理者向けシステム - タスク管理機能
3. ユーザー向けシステム

### 6.3 メール通知
- 使用サービス: **Resend**

### 6.4 認証方式（管理者）
- 管理者は社内の1名のみ使用想定
- **Streamlit標準認証**または**ID/Passハードコード**で十分

### 6.5 画像データ規模
| 項目 | 値 |
|------|-----|
| 1商品あたりの組立ページ数 | 平均 20〜30ページ、最大 100ページ |

### 6.6 運用環境
- **管理者向けシステム**: 社内サーバー or GCP
- **デプロイ方式**: Docker（コンテナ）化を予定
- **要件**: Supabaseにアクセス可能であれば動作可

## 7. 関連ドキュメント

- [アーキテクチャ設計書](./architecture.md)
- [データベース設計書](./database_design.md)
- [API設計書](./api_design.md)
- [UI/UX設計書](./ui_design.md)
- [ユーザー向け要件定義書](./requirements_user.md)
- [管理者向け要件定義書](./requirements_admin.md)
- [組立番号検出要件](./assembly_detection_requirements.md)
- [画像検出アルゴリズム](./image_detection_algorithms.md)
- [ログ仕様書](./logging_specification.md)
- [管理ツール操作ガイド](./admin_tool_guide.md)
